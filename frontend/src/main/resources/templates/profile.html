<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

    <title>Twitter</title>
    <head th:replace="fragment/header :: head"></head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {



            var base_url = "http://localhost:9092/following/";

            var currentUser = [[${currentUser}]];

            var followingUser = [[${profile.user_id}]];

            var url = base_url + currentUser + '/' + followingUser;

            /*$.ajax({
                url: url,
                type: 'GET',
                data: {},

                success: function (result) {

                    if (result.follow == "true") {
                        // is following

                        $('#followButton').html('1')

                    } else {
                        // not following
                        $('#followButton').html('2')

                    }
                },
                error: function (xhr) {
                    alert(xhr.status);
                }
            });*/

        });
    </script>

    <body>
        <div th:replace="fragment/menu :: div"></div>
        <div class="container">

            <div class="row justify-content-center">

                <div class="col-3">
                    <!------------ PROFILE BOX ------------->

                    <p th:text="${profile.firstName}"></p>
                    <p th:text="${profile.lastName}"></p>
                    <p th:text="${profile.userName}"></p>
                    <p th:text="${profile.accountCreated}"></p>
                    <img style="width: 2em; height: 2em" th:src="@{'/static/images/profile/'} + ${profile.profileImageName}">

                    <p th:text=" 'Followers:' + ${followers}"></p>
                    <p th:text=" 'Following: ' + ${followings}"></p>
                    <p th:text=" 'Tweets:' + ${tweetCount}"></p>

                    <div th:if="${currentUser != profile.user_id}">

                        <form th:action="@{'/follow/' + ${profile.user_id} }" method="post" modelAttribute="follow">

                            <input type="hidden" th:value="${follow.id}" name="id">

                            <button th:if="${!isFollowing}" id="followButton" class="btn btn-success">Follow</button>

                        </form>

                        <form th:action="@{'/unfollow/' + ${profile.user_id} }" method="get">
                            <button th:if="${isFollowing}" class="btn btn-danger">Unfollow</button>
                        </form>




                    </div>




                </div>

                <div class="col-6">

                    <div th:if="${feedTweets.empty}">
                        <p>No tweets yet...</p>
                    </div>

                    <!--------- TWEET FEED --------->
                    <div th:each="t : ${feedTweets}">

                        <!--------- NEW TWEET --------->
                        <div th:if="${t.newTweet == null}">
                            <div class="tweetbox">

                                <div class="tweetbox-image-box">
                                    <img class="tweet-profile-pic" th:src="@{'/static/images/profile/' + ${t.profileImageName} }" alt="">
                                </div>

                                <div class="tweetbox-content">
                                    <div class="name-field">
                                        <span class="name" th:text="${t.firstName} + ' ' + ${t.lastName}"></span>
                                        <span class="grey-text" th:text="' @' + ${t.userName}"></span>
                                        <span class="grey-text">⋅</span>
                                        <span class="grey-text" th:text="${t.dateTime}"></span>
                                        <br>
                                        <span class="tweet-message" th:text="${t.message}"></span>
                                    </div>

                                    <img th:if="${t.imageName != null}" class="tweet-pic" th:src="@{'/static/images/tweet/' + ${t.imageName} }" alt="">

                                    <div class="interaction-field">

                                        <table>
                                            <tbody>
                                            <tr>
                                                <td class="interaction-item">
                                                    <img class="icon" th:src="@{'/assets/comment.png'}">
                                                    <span class="interaction-text">42</span>
                                                </td>
                                                <td class="interaction-item">

                                                    <form th:action="@{'/retweet/' + ${t.tweet_id} }" method="post" modelAttribute="retweet">

                                                        <input type="hidden" th:value="${retweet.rid}" name="rid">

                                                        <a class="no-text-decoration" href="#" onclick="this.parentNode.submit();">
                                                            <div class="interaction-div">
                                                                <img class="retweet-icon" th:src="@{'/assets/gray-retweet.svg'}">
                                                                <span class="interaction-text">0</span>
                                                            </div>

                                                        </a>

                                                    </form>

                                                </td>
                                                <td class="interaction-item">
                                                    <img class="icon" th:src="@{'/assets/heart.png'}">
                                                    <span class="interaction-text">89</span>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>

                                    </div>

                                </div>

                            </div>
                        </div>

                        <!--

                        <a style="font-size: 0.9em" th:href="@{'/deleteTweet/' + ${t.id} }">Delete</a>

                        <a style="font-size: 0.9em" href="#">Like</a>

                        <a style="font-size: 0.9em" href="#">Share</a>

                        -->

                        <!--------- RETWEET --------->
                        <div th:if="${t.newTweet != null}">

                            <div class="tweetbox">

                                <div class="retweet-box">
                                    <img class="user-retweet-icon" th:src="@{'/assets/gray-retweet.svg'}">
                                    <span class="retweeted-text" th:text="${t.firstName} + ' ' + ${t.lastName} + ' Retweeted' "></span>
                                </div>

                                <div class="tweetbox-image-box">
                                    <img class="tweet-profile-pic" th:src="@{'/static/images/profile/' + ${t.newTweet.profileImageName} }" alt="">
                                </div>

                                <div class="tweetbox-content">
                                    <div class="name-field">
                                        <span class="name" th:text="${t.newTweet.firstName} + ' ' + ${t.newTweet.lastName}"></span>
                                        <span class="grey-text" th:text="' @' + ${t.newTweet.userName}"></span>
                                        <span class="grey-text">⋅</span>
                                        <span class="grey-text" th:text="${t.newTweet.dateTime}"></span>
                                        <br>
                                        <span class="tweet-message" th:text="${t.newTweet.message}"></span>
                                    </div>

                                    <img th:if="${t.newTweet.imageName != null}" class="tweet-pic" th:src="@{'/static/images/tweet/' + ${t.newTweet.imageName} }" alt="">

                                    <div class="interaction-field">

                                        <table>
                                            <tbody>
                                            <tr>
                                                <td class="interaction-item">
                                                    <img class="icon" th:src="@{'/assets/comment.png'}">
                                                    <span class="interaction-text">42</span>
                                                </td>
                                                <td class="interaction-item">


                                                    <form th:action="@{'/retweet/' + ${t.newTweet.tweet_id} }" method="post" modelAttribute="retweet">

                                                        <input type="hidden" th:value="${retweet.rid}" name="rid">

                                                        <a class="no-text-decoration" href="#" onclick="this.parentNode.submit();">
                                                            <div class="interaction-div">
                                                                <img class="retweet-icon" th:src="@{'/assets/gray-retweet.svg'}">
                                                                <span class="interaction-text">0</span>
                                                            </div>

                                                        </a>

                                                    </form>

                                                </td>
                                                <td class="interaction-item">
                                                    <img class="icon" th:src="@{'/assets/heart.png'}">
                                                    <span class="interaction-text">89</span>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>

                                    </div>

                                </div>

                            </div>

                            <!--
                            <a style="font-size: 0.9em" th:href="@{'/deleteRetweet/' + ${t.newTweet.id} }">Undo retweet</a>

                            <a style="font-size: 0.9em" href="#">Like</a>
                            <a style="font-size: 0.9em" href="#">Share</a>
                            -->

                        </div>

                    </div>

                </div>

                <div class="col-3">
                    <!--------- FOLLOW BOX --------->
                    <div class="follow-box"></div>
                </div>

            </div>

        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </body>
</html>